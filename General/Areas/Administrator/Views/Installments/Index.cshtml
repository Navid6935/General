@model IEnumerable<General.Areas.Administrator.Models.Installment>

@{
    ViewBag.Title = "اقساط - لیست";
    Layout = "~/Areas/Administrator/Views/Shared/_Layout.cshtml";
}
<div class="col-md-12" style="margin-top:15px;margin-bottom:15px;border:1px dashed;border-radius:5px;padding-bottom:15px">
    <div class="row col-md-12" style="margin-top:15px;margin-right:1px;padding-bottom:15px;border-bottom:1px dashed">
        <div class="col-md-5 col-sm-5 col-xs-5">
            <label class="control-label col-md-5 col-sm-5 col-xs-5" style="color:black;font-size:20px;margin-top:12px">از تاریخ</label>
            <div class="col-sm-6 col-md-6 col-xs-6" style="margin-top:10px">
                @*<select class="form-control" id="Year">
                        <option></option>
                        @for (int y = 1397; y <= 1450; y++)
                        {
                            <option value="@y">@y</option>
                        }
                    </select>*@
                <input type="text" id="FromDate" class="text-center" />

            </div>
        </div>
        <div class="col-md-5 col-sm-5 col-xs-5">
            <label class="control-label col-md-5 col-sm-5 col-xs-5" style="color:black;font-size:20px;margin-top:12px">تا تاریخ</label>
            <div class="col-sm-6 col-md-6 col-xs-6" style="margin-top:10px">
                @*<select class="form-control" id="Mounth">
                        <option></option>
                        <option value="1">فروردین</option>
                        <option value="2">اردیبهشت</option>
                        <option value="3">خرداد</option>
                        <option value="4">تیر</option>
                        <option value="5">مرداد</option>
                        <option value="6">شهریور</option>
                        <option value="7">مهر</option>
                        <option value="8">آبان</option>
                        <option value="9">آذر</option>
                        <option value="10">دی</option>
                        <option value="11">بهمن</option>
                        <option value="12">اسفند</option>
                    </select>*@
                <input type="text" id="ToDate" class="text-center" />

            </div>
        </div>
        <div class="col-sm-1 col-md-1 col-xs-1">
            <a class="btn-floating btn-large waves-effect waves-light blue tooltipped" data-position="top" data-delay="50" data-tooltip="جستجو" id="search"><i class="material-icons">search</i></a>

        </div>
        <div class="col-sm-1 col-md-1 col-xs-1">
            <a class="btn-floating btn-large waves-effect waves-light green tooltipped" data-position="top" data-delay="50" data-tooltip="خروجی اکسل" id="exporttoexcel"><i class="material-icons">file_download</i></a>

        </div>
    </div>
    @*</fieldset>
        <fieldset>
            <legend dir="rtl">بر اساس کد بازاریابی </legend>*@
    <div class="row col-md-12" style="margin-right:1px;padding-bottom:15px;border-bottom:1px dashed">
        <div class="col-md-11 col-sm-11 col-xs-11">
            <label class="control-label col-md-3 col-sm-3 col-xs-3" style="color:black;font-size:20px;margin-top:12px">کد بازاریابی</label>
            <div class="col-sm-6 col-md-6 col-xs-6" style="margin-top:10px">
                @*<select class="form-control" id="Year">
                        <option></option>
                        @for (int y = 1397; y <= 1450; y++)
                        {
                            <option value="@y">@y</option>
                        }
                    </select>*@
                <input type="text" id="MarketingCode" class="text-center" maxlength="13" />

            </div>
        </div>
        <div class="col-sm-1 col-md-1 col-xs-1">
            <a class="btn-floating btn-large waves-effect waves-light blue tooltipped" data-position="top" data-delay="50" data-tooltip="جستجو بر اساس کد بازاریابی" id="searchMarketingCode"><i class="material-icons">search</i></a>

        </div>

    </div>
    @*</fieldset>
        <fieldset>
            <legend dir="rtl">بر اساس شماره بیمه نامه</legend>*@
    <div class="row col-md-12">
        <div class="col-md-11 col-sm-11 col-xs-11">
            <label class="control-label col-md-3 col-sm-3 col-xs-3" style="color:black;font-size:20px;margin-top:12px">شماره بیمه نامه</label>
            <div class="col-sm-1 col-md-1 col-xs-1 col-md-pull-8" style="margin-top:10px">
                <input type="text" id="InsuranceNum1" class="text-center col-md-2" maxlength="2" />
            </div>
            <div class="col-sm-2 col-md-2 col-xs-2 col-md-pull-5" style="margin-top:10px">
                <input type="text" id="InsuranceNum2" class="text-center col-md-2" maxlength="5" />
            </div>
            <div class="col-sm-1 col-md-1 col-xs-1 col-md-pull-2" style="margin-top:10px">
                <input type="text" id="InsuranceNum3" class="text-center col-md-2" maxlength="1" />
            </div>
            <div class="col-sm-1 col-md-1 col-xs-1" style="margin-top:10px">
                <input type="text" id="InsuranceNum4" class="text-center col-md-2" maxlength="1" />
            </div>
            <div class="col-sm-2 col-md-2 col-xs-2  col-md-push-3" style="margin-top:10px">
                <input type="text" id="InsuranceNum5" class="text-center col-md-2" maxlength="4" />
            </div>
            <div class="col-sm-2 col-md-2 col-xs-2  col-md-push-7" style="margin-top:10px">
                <input type="text" id="InsuranceNum6" class="text-center col-md-2" maxlength="5" />
            </div>
        </div>
        <div class="col-sm-1 col-md-1 col-xs-1">
            <a class="btn-floating btn-large waves-effect waves-light blue tooltipped" data-position="top" data-delay="50" data-tooltip="جستجو بر اساس شماره بیمه نامه" id="searchOnInsuranceNum"><i class="material-icons">search</i></a>

        </div>
    </div>
</div>


<table class="table table-bordered table-striped right-align table-responsive" dir="rtl" style="margin-top:15px" id="Installmenttbl">
    <tr class="grey">
        <th class="text-center" rowspan="2" style="padding-top:25px">
            @Html.DisplayNameFor(model => model.MarketingCode)
        </th>
        <th class="text-center" rowspan="2" style="padding-top:25px">
            @Html.DisplayNameFor(model => model.FirstName)
        </th>
        <th class="text-center" rowspan="2" style="padding-top:25px">
            @Html.DisplayNameFor(model => model.LastName)
        </th>
        @*<th class="center">
                @Html.DisplayNameFor(model => model.InsuranceNumber)
            </th>*@
        <th class="text-center" rowspan="2" style="padding-top:25px">
            @Html.DisplayNameFor(model => model.InstallmentsNumbersAmount)
        </th>
        <th class="text-center" rowspan="2" style="padding-top:25px">
            @Html.DisplayNameFor(model => model.InsuranceNumber)
        </th>
        <th class="text-center" colspan="3">
            تاریخ سررسید
        </th>

        @*<th class="center">

                @Html.DisplayNameFor(model => model.InstallmentsNumbersNum)
            </th>
            <th class="center">

                @Html.DisplayNameFor(model => model.InstallmentsNumberId)
            </th>*@
        <th class="text-center" rowspan="2" style="padding-top:25px">

            @Html.DisplayNameFor(model => model.InstallmentsNumberStatus)
        </th>
        <th class="text-center" rowspan="2" style="padding-top:25px">

            @Html.DisplayNameFor(model => model.InstallmentsNumberMansStatus)
        </th>
        @if (ViewBag.UserName == "483004311139639539")
        {
            <th class="text-center" rowspan="2" style="padding-top:25px">
                @FarsiLanguage.FarsiLanguage._Options
            </th>
        }
        else
        {

        }
    </tr>
    <tr class="grey">
        <th class="text-center">
            @Html.DisplayNameFor(model => model.DayInstallmentNumber)
        </th>
        <th class="text-center">
            @Html.DisplayNameFor(model => model.MounthInstallmentNumber)
        </th>
        <th class="text-center">
            @Html.DisplayNameFor(model => model.YearInstallmentNumber)
        </th>
    </tr>
    @foreach (var item in Model)
    {
        <tr>
            <td class="center">
                @Html.DisplayFor(modelItem => item.MarketingCode)
            </td>
            <td class="center">

                @Html.DisplayFor(modelItem => item.FirstName)
            </td>
            <td class="center">

                @Html.DisplayFor(modelItem => item.LastName)
            </td>
            @*<td class="center">

                    @Html.DisplayFor(modelItem => item.InsuranceNumber)
                </td>*@
            <td class="center">

                @Html.DisplayFor(modelItem => item.InstallmentsNumbersAmount)
            </td>
            <td class="center">

                @Html.DisplayFor(modelItem => item.InsuranceNumber)
            </td>
            <td class="text-center" id="DayInstallmentNumber">
                @Html.DisplayFor(modelItem => item.DayInstallmentNumber)
            </td>
            <td class="text-center" id="MounthInstallmentNumber">
                @Html.DisplayFor(modelItem => item.MounthInstallmentNumber)
            </td>
            <td class="text-center" id="YearInstallmentNumber">
                @Html.DisplayFor(modelItem => item.YearInstallmentNumber)
            </td>
            @*<td class="center">

                    @Html.DisplayFor(modelItem => item.InstallmentsNumbersNum)
                </td>
                <td class="center">

                    @Html.DisplayFor(modelItem => item.InstallmentsNumberId)
                </td>*@
            <td class="center">
                @{
                    if (item.InstallmentsNumberStatus == 0)
                    {
                        <span>
                            در انتظار پرداخت
                        </span>
                    }
                    if (item.InstallmentsNumberStatus == 1)
                    {
                        <span class="green-text darken-1">
                            پرداخت شده
                        </span>
                    }
                }
            </td>
            <td class="center">
                @{
                    if (item.InstallmentsNumberMansStatus == 0)
                    {
                        <span>
                            در انتظار تایید
                        </span>
                    }
                    if (item.InstallmentsNumberMansStatus == 1)
                    {
                        <span>
                            تایید شده
                        </span>
                    }
                }
            </td>
            @{
                var UserName = ViewBag.UserName;
                if (UserName == "483004311139639539")
                {
                    <td class="center">

                        @* <a href="@Url.Action("Details", new { id=item.InstallmentId })" class="btn-floating tooltipped blue" data-position="right" data-delay="50" data-tooltip="جزئیات" blue"><i class="material-icons">dehaze</i></a> |*@
                        <a href="@Url.Action("Edit", new { id=item.InstallmentId })" class="btn-floating tooltipped yellow darken-2" data-position="top" data-delay="50" data-tooltip="ویرایش" blue"><i class="material-icons">edit</i></a> |
                        <a href="@Url.Action("Delete", new { id=item.InstallmentId })" class="btn-floating tooltipped red" data-position="left" data-delay="50" data-tooltip="حذف" blue"><i class="material-icons">delete</i></a>
                    </td>
                }
                else
                {

                }
            }

        </tr>
    }

</table>
@*<div class="fixed-action-btn horizontal click-to-toggle">
        <a class="btn-floating btn-large pulse blue">
            <i class="material-icons">menu</i>
        </a>
        <ul>
            <li><a href="@Url.Action("Index", "Home", new { area = "" }, null)" class="btn tooltipped btn-floating blue darken-3" data-position="top" data-tooltip="صفحه اصلی" data-delay="50"><i class="material-icons">home</i></a></li>
            <li><a href="@Url.Action("create")" class="btn tooltipped btn-floating green darken-1" data-position="top" data-delay="50" data-tooltip="ایجاد"><i class="material-icons">create_new_folder</i></a></li>
        </ul>
    </div>*@
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script src="~/Scripts/MyScripts/PlanFunc.js"></script>
<script src="~/Scripts/jquery-1.11.0.min.js"></script>
<script src="~/Scripts/SweetAlert.js"></script>
<link href="~/Content/sweetalert/sweet-alert.css" rel="stylesheet" />
<script>


    $(document).ready(function () {


        var str2 = '<li>@Html.ActionLink(FarsiLanguage.FarsiLanguage._Installment, "Index", "Installments", new { area = "Administrator" }, null)</li>';
        if (@Session["PId"] == "483004311139639539") {
          var str1 = '<li>@Html.ActionLink(FarsiLanguage.FarsiLanguage._AdministratorPage, "AdminsMainPage", "AdminGeneralpages", new { area = "Administrator" }, null)</li>';

        }
        else {
        var str1 = '<li>@Html.ActionLink(FarsiLanguage.FarsiLanguage._UserMainPage, "UserMainPage", "GeneralPages", new { area = "Users" }, null)</li>';

        }
        $('.crumbs').append(str1);
        $('.crumbs').append(str2);

        $("#search").click(function () {

            var FromDate = $("#FromDate").val().replace(/\//g, '');
            var ToDate = $("#ToDate").val().replace(/\//g, '');

            if (FromDate == "" || FromDate == null) {
               swal("خطا!", "فیلد ها را تکمیل نمایید", "error");
                return false;
            }
            if (ToDate == "" || ToDate == null) {
               swal("خطا!", "فیلد ها را تکمیل نمایید", "error");
                return false;
            }
            
            $("#Installmenttbl").find("tr:gt(1)").remove();
            GetExcelPaymentOnPeriodInIndex(FromDate,ToDate);
            //alert(InstallmentonPeriodArray.length)
            if (InstallmentonPeriodArrayInIndex.length == 0) {
               swal("خطا!", "در این ماه اطلاعات  موجود نمی باشد", "error");
                return false;
            }
           var counter = 0;
        var toCounter = 10;
        var Rows = InstallmentonPeriodArrayInIndex.length / 11;
        for (var i = 1; i <= Rows; i++) {
        $("tr:last").after('<tr id=mk' + i + '>' );
        while (counter < toCounter) {

                 $('#mk' + i).append('<td class="text-center" id="rowNum' + counter + '">' + InstallmentonPeriodArrayInIndex[counter] + '</td>');
                       if ($('#rowNum' + counter).text() == "پرداخت شده" || $('#rowNum' + counter).text() == "تایید شده	") {
                            $('#rowNum' + counter).addClass("green-text darken-1");
                         }

                        counter++;
                    }
                    toCounter = toCounter + 11;

                   // alert(counter);
            $('#rowNum' + (counter - 1)).after('<td class="text-center" id= "rowNum' + counter + '" ><a href="../Edit/' + InstallmentonPeriodArrayInIndex[counter] + '" class="btn-floating tooltipped yellow darken-2" data-position="top" data-delay="50" data-tooltip="ویرایش" blue"><i class="material-icons">edit</i></a> | <a href="../Delete/' + InstallmentonPeriodArrayInIndex[counter] + '" class="btn-floating tooltipped red darken-2" data-position="top" data-delay="50" data-tooltip="حذف" blue"><i class="material-icons">delete</i></a></td>'); 
            
                    counter++;
            $('#mk' + i).after("</tr>");

        }

        });
        //=============================================فیاتر کد بازاریابی
          $("#MarketingCode").keyup(function () {
            var MarketingCode = $(this).val();
            if (MarketingCode.length == 13) {
                $(this).css("border-color","green")
            }
            else {
                $(this).css("border-color","red")

            }
        })
          $("#searchMarketingCode").click(function () {

            var MarketingCode = $("#MarketingCode").val();
            if (MarketingCode == "" || MarketingCode == null) {
               swal("خطا!", "فیلد کد بازاریابی را تکمیل نمایید", "error");
                return false;
            }
            $("#Installmenttbl").find("tr:gt(1)").remove();
            GetExcelPaymentOnPeriodOnMarketingCodeInIndex(MarketingCode);
            //alert(InstallmentonPeriodArray.length)
            if (InstallmentonPeriodArrayInIndex.length == 0) {
               swal("خطا!", "برای این کد بازاریابی اطلاعات اقساط  موجود نمی باشد", "error");
                return false;
            }

            var counter = 0;
            var toCounter = 10;
            var Rows = InstallmentonPeriodArrayInIndex.length / 11;
            for (var i = 1; i <= Rows; i++) {
                $("tr:last").after('<tr id=mk' + i + '>');

                while (counter < toCounter) {
                     $('#mk' + i).append('<td class="text-center" id="rowNum' + counter + '">' + InstallmentonPeriodArrayInIndex[counter] + '</td>');
                       if ($('#rowNum' + counter).text() == "پرداخت شده" || $('#rowNum' + counter).text() == "تایید شده	") {
                            $('#rowNum' + counter).addClass("green-text darken-1");
                         }

                        counter++;
                    }
                    toCounter = toCounter + 11;

                   // alert(counter);
            $('#rowNum' + (counter - 1)).after('<td class="text-center" id= "rowNum' + counter + '" ><a href="../Edit/' + InstallmentonPeriodArrayInIndex[counter] + '" class="btn-floating tooltipped yellow darken-2" data-position="top" data-delay="50" data-tooltip="ویرایش" blue"><i class="material-icons">edit</i></a> | <a href="../Delete/' + InstallmentonPeriodArrayInIndex[counter] + '" class="btn-floating tooltipped red darken-2" data-position="top" data-delay="50" data-tooltip="حذف" blue"><i class="material-icons">delete</i></a></td>'); 
            
                    counter++;
            $('#mk' + i).after("</tr>");

        }

        });
        //========================================== فیلتر شماره بیمه نامه
          $("#searchOnInsuranceNum").click(function () {
            var InsuranceNum1 = $("#InsuranceNum1").val();
            var InsuranceNum2 = $("#InsuranceNum2").val();
            var InsuranceNum3 = $("#InsuranceNum3").val();
            var InsuranceNum4 = $("#InsuranceNum4").val();
            var InsuranceNum5 = $("#InsuranceNum5").val();
             var InsuranceNum6 = $("#InsuranceNum6").val();
            var InsuranceNum = InsuranceNum6 + " " + InsuranceNum5 + " " + InsuranceNum4 + " " + InsuranceNum3 + " " + InsuranceNum2 + " " + InsuranceNum1;
            if (InsuranceNum1 == "" || InsuranceNum1 == null) {
               swal("خطا!", "فیلد شماره بیمه را تکمیل نمایید", "error");
                return false;
             }
            if (InsuranceNum2 == "" || InsuranceNum2 == null) {
               swal("خطا!", "فیلد شماره بیمه را تکمیل نمایید", "error");
                return false;
             }
            if (InsuranceNum3 == "" || InsuranceNum3 == null) {
               swal("خطا!", "فیلد شماره بیمه را تکمیل نمایید", "error");
                return false;
             }
            if (InsuranceNum4 == "" || InsuranceNum4 == null) {
               swal("خطا!", "فیلد شماره بیمه را تکمیل نمایید", "error");
                return false;
             }
            if (InsuranceNum5 == "" || InsuranceNum5 == null) {
               swal("خطا!", "فیلد شماره بیمه را تکمیل نمایید", "error");
                return false;
             }
            if (InsuranceNum6 == "" || InsuranceNum6 == null) {
               swal("خطا!", "فیلد شماره بیمه را تکمیل نمایید", "error");
                return false;
            }
            $("#Installmenttbl").find("tr:gt(1)").remove();
            GetListOnPeriodOnInsuranceNumInIndex(InsuranceNum);
            //alert(InstallmentonPeriodArray.length)
            if (InstallmentonPeriodArrayInIndex.length == 0) {
               swal("خطا!", "برای این شماره بیمه اقساط  موجود نمی باشد", "error");
                return false;
            }
              debugger
            var counter = 0;
            var toCounter = 10;
            var Rows = InstallmentonPeriodArrayInIndex.length / 11;
            for (var i = 1; i <= Rows; i++) {
                $("tr:last").after('<tr id=mk' + i + '>');

                while (counter < toCounter) {
                     $('#mk' + i).append('<td class="text-center" id="rowNum' + counter + '">' + InstallmentonPeriodArrayInIndex[counter] + '</td>');
                       if ($('#rowNum' + counter).text() == "پرداخت شده" || $('#rowNum' + counter).text() == "تایید شده	") {
                            $('#rowNum' + counter).addClass("green-text darken-1");
                         }

                        counter++;
                    }
                    toCounter = toCounter + 11;

                   // alert(counter);
            $('#rowNum' + (counter - 1)).after('<td class="text-center" id= "rowNum' + counter + '" ><a href="../Edit/' + InstallmentonPeriodArrayInIndex[counter] + '" class="btn-floating tooltipped yellow darken-2" data-position="top" data-delay="50" data-tooltip="ویرایش" blue"><i class="material-icons">edit</i></a> | <a href="../Delete/' + InstallmentonPeriodArrayInIndex[counter] + '" class="btn-floating tooltipped red darken-2" data-position="top" data-delay="50" data-tooltip="حذف" blue"><i class="material-icons">delete</i></a></td>'); 
            
                    counter++;
            $('#mk' + i).after("</tr>");

        }

        });
        $("#exporttoexcel").on('click', function (e) {
            e.preventDefault();
            ResultsToTable();

        });
        function ResultsToTable() {
            $("#Installmenttbl").table2excel({
                exclude: ".noExl",
                name: "Results"
            });
        }

    });
</script>